price_data <- tq_get(tickers,
from = '2017-12-27',
to = '2021-12-27',
get = 'stock.prices')
price_data
ret_data <- price_data %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "daily",
col_rename = "ret")
head(covid_joined)
# Asset tickers
tickers = c("SPY")
price_data <- tq_get(tickers,
from = '2017-12-27',
to = '2021-12-27',
get = 'stock.prices')
price_data
ret_data <- price_data %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "daily",
col_rename = "ret")
covid_joined$Change.. <- as.numeric(gsub("%","",covid_joined$Change..))
sp500$cr <- (as.numeric(gsub("%","",sp500$Change..))/100) %>% mutate(cr = cumprod(1 + sp500$cr))
port_ret_tidyquant <- ret_data %>%
tq_portfolio(assets_col = symbol,
returns_col = ret,
col_rename = 'port_ret',
geometric = FALSE)
covid_joined$Change.. <- as.numeric(gsub("%","",covid_joined$Change..))
sp500$cr <- (as.numeric(gsub("%","",sp500$Change..))/100) %>% mutate(cr = cumprod(1 + sp500$cr))
library(tidyquant)
# Asset tickers
tickers = c('BND', 'VB', 'VEA', 'VOO', 'VWO')
# Asset weights
wts = c(0.1,0.2,0.25,0.25,0.2)
price_data <- tq_get(tickers,
from = '2013-01-01',
to = '2018-03-01',
get = 'stock.prices')
ret_data <- price_data %>%
group_by(symbol) %>%
tq_transmute(select = adjusted,
mutate_fun = periodReturn,
period = "daily",
col_rename = "ret")
port_ret_tidyquant <- ret_data %>%
tq_portfolio(assets_col = symbol,
returns_col = ret,
weights = wts,
col_rename = 'port_ret',
geometric = FALSE)
df_q2_scatter_plot_Lprice_var_fac = function(plot_df, xvar, xvar_lab, title) {
p1 = ggplot(data = plot_df, aes(x = xvar, group=location, color = location)) +
geom_point(aes(y=Lprice)) +
facet_grid(location ~ .) +
ggtitle(title) + xlab(xvar_lab) +
ylab("Price") +
theme_bw()
p1
}
df_q2$Lprice = log(df_q2$Price/lag(df_q2$Price))
df_q2$Lnew_vaccinations = log(df_q2$new_vaccinations/lag(df_q2$new_vaccinations))
df_q2$Lnew_tests = log(df_q2$new_tests/lag(df_q2$new_tests))
df_q2$Lnew_cases = log(df_q2$new_cases/lag(df_q2$new_cases))
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_tests, "new_tests", "log return(Price)~Log return(new_tests)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_vaccinations, "new_vaccinations", "Log return(Price)~Log return(new_vaccinations)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_cases, "new_vaccinations", "Log return(Price)~Log return(new_cases)")
#colnames(df_q2)
df_q2_date = df_q2 %>% drop_na(new_cases, new_tests, new_vaccinations) %>% group_by(Date) %>% summarize(avg_price = mean(Price), avg_new_cases = mean(new_cases), avg_new_tests = mean(new_tests), avg_new_vac = mean(new_vaccinations))
p1 = ggplot(data = df_q2_date, aes(x = Date)) + geom_line(aes(y=avg_new_cases), color = 'red') +
geom_line(aes(y=avg_new_vac), color = 'light green') +
geom_line(aes(y=avg_new_tests), color = 'light blue') +
ggtitle("covid data plot") + xlab("date") +
ylab("values")+
theme_bw()
ggplotly(p1)
df_q2_cor = df_q2 %>% drop_na(new_vaccinations, new_tests, new_cases, Price) %>% select(new_vaccinations, new_tests, new_cases, Price)
cor(df_q2_cor)
qtlcharts::iplotCorr(df_q2_cor)
#covid_clean
df_q2_beta = df_q2 %>% drop_na(Lprice2, Lnew_cases2)
df_q2_cor = df_q2 %>% drop_na(new_vaccinations, new_tests, new_cases, Price) %>% select(new_vaccinations, new_tests, new_cases, Price)
cor(df_q2_cor)
qtlcharts::iplotCorr(df_q2_cor)
wts_tbl <- tibble(symbol = tickers,
wts = wts)
ret_data <- left_join(ret_data,wts_tbl, by = 'symbol')
ret_data <- ret_data %>%
mutate(wt_return = wts * ret)
library(tidyverse)
library(ggplot2)
library(maps)
library(plotly)
library(caret)
library(dplyr)
library(lubridate)
library(scales)
library(magrittr)
library(tidyr)
library(pkr)
library(plotly)
library(ggthemes)
library(tseries)
library(quantmod)
library(roll)
library(plotly)
library(gganimate)
library(tidyquant)
mySymbols <- c('AMZN', '^GSPC','NFLX','MSFT','GOOG','NVAX','DIS','WMT','COST','V','FB','AXP','CMCSA','PFE','MRNA')
myStocks <-lapply(mySymbols, function(x) {getSymbols(x, src = "yahoo",
from = "2020-01-01",
to = "2022-04-04",
periodicity = "daily",
auto.assign=FALSE)} )
df_q2_scatter_plot_Lprice_var_fac = function(plot_df, xvar, xvar_lab, title) {
p1 = ggplot(data = plot_df, aes(x = xvar, group=location, color = location)) +
geom_point(aes(y=Lprice)) +
facet_grid(location ~ .) +
ggtitle(title) + xlab(xvar_lab) +
ylab("Price") +
theme_bw()
p1
}
df_q2$Lprice = log(df_q2$Price/lag(df_q2$Price))
df_q2$Lnew_vaccinations = log(df_q2$new_vaccinations/lag(df_q2$new_vaccinations))
df_q2$Lnew_tests = log(df_q2$new_tests/lag(df_q2$new_tests))
df_q2$Lnew_cases = log(df_q2$new_cases/lag(df_q2$new_cases))
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_tests, "new_tests", "log return(Price)~Log return(new_tests)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_vaccinations, "new_vaccinations", "Log return(Price)~Log return(new_vaccinations)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_cases, "new_vaccinations", "Log return(Price)~Log return(new_cases)")
covid = read.csv("owid-covid-data.csv")
ASX200 = read.csv("S&P_ASX 200 Historical Data.csv", fileEncoding = 'UTF-8-BOM') # This is for Australia
df_q2 = covid_joined
colnames(df_q2)[7] = 'Change'
write.csv(df_q2,"df_q2.csv")
df_q2_scatter_plot_Lprice_var_fac = function(plot_df, xvar, xvar_lab, title) {
p1 = ggplot(data = plot_df, aes(x = xvar, group=location, color = location)) +
geom_point(aes(y=Lprice)) +
facet_grid(location ~ .) +
ggtitle(title) + xlab(xvar_lab) +
ylab("Price") +
theme_bw()
p1
}
df_q2$Lprice = log(df_q2$Price/lag(df_q2$Price))
df_q2$Lnew_vaccinations = log(df_q2$new_vaccinations/lag(df_q2$new_vaccinations))
df_q2$Lnew_tests = log(df_q2$new_tests/lag(df_q2$new_tests))
df_q2$Lnew_cases = log(df_q2$new_cases/lag(df_q2$new_cases))
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_tests, "new_tests", "log return(Price)~Log return(new_tests)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_vaccinations, "new_vaccinations", "Log return(Price)~Log return(new_vaccinations)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_cases, "new_vaccinations", "Log return(Price)~Log return(new_cases)")
df_q2_cor = df_q2 %>% drop_na(new_vaccinations, new_tests, new_cases, Price) %>% select(new_vaccinations, new_tests, new_cases, Price)
cor(df_q2_cor)
qtlcharts::iplotCorr(df_q2_cor)
library(tidyverse)
library(ggplot2)
library(maps)
library(plotly)
library(caret)
library(dplyr)
library(lubridate)
library(scales)
library(magrittr)
library(tidyr)
library(pkr)
library(plotly)
library(ggthemes)
library(tseries)
library(quantmod)
library(roll)
library(plotly)
library(gganimate)
library(tidyquant)
glm1= glm(Price ~ new_vaccinations + new_tests + new_cases,data = df_q2_cor)
summary(glm1)
plot(glm1, which = 1:2)
library(tidyverse)
library(ggplot2)
library(maps)
library(plotly)
library(caret)
library(dplyr)
library(lubridate)
library(scales)
library(magrittr)
library(tidyr)
library(pkr)
library(plotly)
library(ggthemes)
library(tseries)
library(quantmod)
library(roll)
library(plotly)
library(gganimate)
library(tidyquant)
library(caret)
library(klaR)
# load the library
library(caret)
# define training control
train_control <- trainControl(method="boot", number=100)
# train the model
model <- train(level~., data=df_q2_cor, trControl=train_control, method="nb")
library(tidyverse)
library(ggplot2)
library(maps)
library(plotly)
library(caret)
library(dplyr)
library(lubridate)
library(scales)
library(magrittr)
library(tidyr)
library(pkr)
library(plotly)
library(ggthemes)
library(tseries)
library(quantmod)
library(roll)
library(plotly)
library(gganimate)
library(tidyquant)
library(caret)
library(klaR)
covid = read.csv("owid-covid-data.csv")
ASX200 = read.csv("S&P_ASX 200 Historical Data.csv", fileEncoding = 'UTF-8-BOM') # This is for Australia
df_q2 = covid_joined
colnames(df_q2)[7] = 'Change'
write.csv(df_q2,"df_q2.csv")
glm1= glm(Price ~ new_vaccinations + new_tests + new_cases,data = df_q2_cor)
summary(glm1)
plot(glm1, which = 1:2)
mean(df_q2_cor$Price)
median(df_q2_cor$Price)
quantile(df_q2_cor$Price, 0.25)
#df_q2_cor$level <- ifelse(df_q2_cor$Price < 1978.28, "low", "high")
df_q2_cor <- df_q2_cor %>% mutate(level = case_when((df_q2_cor$Price <= 1978.28) ~ "Low",
((df_q2_cor$Price > 1978.28) & (df_q2_cor$Price < 6511.446)) ~ "Medium",
(df_q2_cor$Price > 6511.446) ~ "High"
))
df_q2_cor
set.seed(1)
split = 0.8
## 80% 20% train/test
trainIndex <- createDataPartition(df_q2_cor$level, p = split, list = FALSE)
data_train <- df_q2_cor[trainIndex, ]
data_test <- df_q2_cor[-trainIndex, ]
##naive bayes model
model = train(df_q2_cor$level ~ df_q2_cor$new_vaccinations+df_q2_cor$new_tests+df_q2_cor$new_cases+df_q2_cor$Price, data = data_train)
# define training control
train_control <- trainControl(method="cv", number=10)
# train the model
model <- train(df_q2_cor$level~., data=df_q2_cor, trControl=train_control, method="nb")
# define training control
train_control <- trainControl(method="cv", number=10)
# train the model
model <- train(df_q2_cor$level~., data=df_q2_cor, trControl=train_control, method="nb")
table(df_q2_cor$level)
df_q2_cor$level <- as.factor(df_q2_cor$level)
df_q2_cor
# load the library
library(caret)
# define training control
train_control <- trainControl(method="boot", number=100)
# train the model
model <- train(level~., data=df_q2_cor, trControl=train_control, method="nb")
# summarize results
print(model)
model$finalModel
# define training control
train_control <- trainControl(method="repeatedcv", number=10, repeats=3)
# train the model
model <- train(level~., data=df_q2_cor, trControl=train_control, method="nb")
# summarize results
print(model)
set.seed(1)
df_q2_cor$level <- as.factor(df_q2_cor$level)
split = 0.8
## 80% 20% train/test
trainIndex <- createDataPartition(df_q2_cor$level, p = split, list = FALSE)
data_train <- df_q2_cor[trainIndex, ]
data_test <- df_q2_cor[-trainIndex, ]
##naive bayes model
model = train(df_q2_cor$level ~ df_q2_cor$new_vaccinations+df_q2_cor$new_tests+df_q2_cor$new_cases+df_q2_cor$Price, data = data_train)
set.seed(1)
df_q2_cor$level <- as.factor(df_q2_cor$level)
split = 0.8
## 80% 20% train/test
trainIndex <- createDataPartition(df_q2_cor$level, p = split, list = FALSE)
data_train <- df_q2_cor[trainIndex, ]
data_test <- df_q2_cor[-trainIndex, ]
##naive bayes model
model = train(df_q2_cor$level ~ df_q2_cor$new_vaccinations+df_q2_cor$new_tests+df_q2_cor$new_cases+df_q2_cor$Price, data = data_train)
set.seed(1)
df_q2_cor$level <- as.factor(df_q2_cor$level)
split = 0.8
## 80% 20% train/test
trainIndex <- createDataPartition(df_q2_cor$level, p = split, list = FALSE)
data_train <- df_q2_cor[trainIndex, ]
data_test <- df_q2_cor[-trainIndex, ]
##naive bayes model
model = train(df_q2_cor$level ~ df_q2_cor$new_vaccinations+df_q2_cor$new_tests+df_q2_cor$new_cases+df_q2_cor$Price, data = data_train)
set.seed(1)
df_q2_cor$level <- as.factor(df_q2_cor$level)
split = 0.8
## 80% 20% train/test
trainIndex <- createDataPartition(df_q2_cor$level, p = split, list = FALSE)
data_train <- df_q2_cor[trainIndex, ]
data_test <- df_q2_cor[-trainIndex, ]
##naive bayes model
model = train(df_q2_cor$level ~ df_q2_cor$new_vaccinations+df_q2_cor$new_tests+df_q2_cor$new_cases+df_q2_cor$Price, data = data_train)
set.seed(1)
df_q2_cor$level <- as.factor(df_q2_cor$level)
split = 0.8
## 80% 20% train/test
trainIndex <- createDataPartition(df_q2_cor$level, p = split, list = FALSE)
data_train <- df_q2_cor[trainIndex, ]
data_test <- df_q2_cor[-trainIndex, ]
##naive bayes model
model = train(df_q2_cor$level ~ df_q2_cor$new_vaccinations+df_q2_cor$new_tests+df_q2_cor$new_cases+df_q2_cor$Price, data = data_train)
# define training control
train_control <- trainControl(method="repeatedcv", number=10, repeats=3)
# train the model
model <- train(level~., data=df_q2_cor, trControl=train_control, method="knn")
# summarize results
print(model)
View(M0)
model$modelInfo
model$results
model$results$Accuracy
boxplot(model$results$Accuracy)
boxplot(model$results$Accuracy, xlab = "knn")
# define training control
train_control <- trainControl(method="repeatedcv", number=10, repeats=3)
# train the model
model_knn <- train(level~., data=df_q2_cor, trControl=train_control, method="knn")
# summarize results
print(model_knn)
boxplot(model_knn$results$Accuracy, xlab = "knn")
# define training control
train_control <- trainControl(method="repeatedcv", number=10, repeats=5)
# train the model
model_knn <- train(level~., data=df_q2_cor, trControl=train_control, method="knn")
# summarize results
print(model_knn)
boxplot(model_knn$results$Accuracy, xlab = "knn")
# define training control
train_control <- trainControl(method="repeatedcv", number=10, repeats=3)
# train the model
model_knn <- train(level~., data=df_q2_cor, trControl=train_control, method="knn")
# summarize results
print(model_knn)
boxplot(model_knn$results$Accuracy, xlab = "knn")
boxplot(model_knn$results$Accuracy, xlab = "knn")
# define training control
train_control <- trainControl(method="repeatedcv", number=10, repeats=3)
# train the model
model_knn <- train(level~., data=df_q2_cor, trControl=train_control, method="knn")
# summarize results
print(model_knn)
boxplot(model_knn$results$Accuracy, xlab = "knn")
View(price_data)
boxplot(model_knn$results$Accuracy, xlab = "knn", horizontal = TRUE)
boxplot(model_knn$results$Accuracy, ylab = "knn",xlab = "Accuracy", horizontal = TRUE)
library(tidyverse)
library(ggplot2)
library(maps)
library(plotly)
library(caret)
library(dplyr)
library(lubridate)
library(scales)
library(magrittr)
library(tidyr)
library(pkr)
library(plotly)
library(ggthemes)
library(tseries)
library(quantmod)
library(roll)
library(plotly)
library(gganimate)
library(tidyquant)
library(caret)
library(klaR)
library(zoo)
covid = read.csv("owid-covid-data.csv")
ASX200 = read.csv("S&P_ASX 200 Historical Data.csv", fileEncoding = 'UTF-8-BOM') # This is for Australia
df_q2 = covid_joined
colnames(df_q2)[7] = 'Change'
write.csv(df_q2,"df_q2.csv")
colnames(D1)[1] ="start_date"
colnames(D1)[1] ="start_date"
df_q2_scatter_plot_Lprice_var_fac = function(plot_df, xvar, xvar_lab, title) {
p1 = ggplot(data = plot_df, aes(x = xvar, group=location, color = location)) +
geom_point(aes(y=Lprice)) +
facet_grid(location ~ .) +
ggtitle(title) + xlab(xvar_lab) +
ylab("Price") +
theme_bw()
p1
}
df_q2$Lprice = log(df_q2$Price/lag(df_q2$Price))
df_q2$Lnew_vaccinations = log(df_q2$new_vaccinations/lag(df_q2$new_vaccinations))
df_q2$Lnew_tests = log(df_q2$new_tests/lag(df_q2$new_tests))
df_q2$Lnew_cases = log(df_q2$new_cases/lag(df_q2$new_cases))
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_tests, "new_tests", "log return(Price)~Log return(new_tests)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_vaccinations, "new_vaccinations", "Log return(Price)~Log return(new_vaccinations)")
df_q2_scatter_plot_Lprice_var_fac(df_q2, df_q2$Lnew_cases, "new_vaccinations", "Log return(Price)~Log return(new_cases)")
#colnames(df_q2)
df_q2_date = df_q2 %>% drop_na(new_cases, new_tests, new_vaccinations) %>% group_by(Date) %>% summarize(avg_price = mean(Price), avg_new_cases = mean(new_cases), avg_new_tests = mean(new_tests), avg_new_vac = mean(new_vaccinations))
p1 = ggplot(data = df_q2_date, aes(x = Date)) + geom_line(aes(y=avg_new_cases), color = 'red') +
geom_line(aes(y=avg_new_vac), color = 'light green') +
geom_line(aes(y=avg_new_tests), color = 'light blue') +
ggtitle("covid data plot") + xlab("date") +
ylab("values")+
theme_bw()
ggplotly(p1)
df_q2 = as.data.frame(df_q2[order(df_q2$Date),]) %>% drop_na(new_vaccinations, new_tests, new_cases, Price)
df_q2_cor = df_q2 %>% dplyr::select(new_vaccinations, new_tests, new_cases, Price)
cor(df_q2_cor)
qtlcharts::iplotCorr(df_q2_cor)
df_q2_date = df_q2 %>% group_by(Date) %>% summarize(avg_price = mean(Price), avg_new_cases = mean(new_cases), avg_new_tests = mean(new_tests), avg_new_vac = mean(new_vaccinations))
nrow_df_q2 = 360
i = 1
cor1 <- list()
time_ls <- list()
j = 1
while (i <= nrow_df_q2) {
subset <- df_q2_date[i:(i+29),]
cor1[[j]] <- cor.test(subset$avg_price,subset$avg_new_vac, method = "pearson")
time_ls[[j]] = subset[1,1]
j = j + 1
i = i + 30
}
df_q2_date = df_q2 %>% group_by(Date) %>% summarize(avg_price = mean(Price), avg_new_cases = mean(new_cases), avg_new_tests = mean(new_tests), avg_new_vac = mean(new_vaccinations))
nrow_df_q2 = 360
i = 1
cor1 <- list()
time_ls <- list()
j = 1
while (i <= nrow_df_q2) {
subset <- df_q2_date[i:(i+29),]
cor1[[j]] <- cor.test(subset$avg_price,subset$avg_new_vac, method = "pearson")
time_ls[[j]] = subset[1,1]
j = j + 1
i = i + 30
}
colnames(D1)[1] ="start_date"
glm1= glm(Price ~ new_vaccinations + new_tests + new_cases,data = df_q2_cor)
summary(glm1)
plot(glm1, which = 1:2)
mean(df_q2_cor$Price)
median(df_q2_cor$Price)
quantile(df_q2_cor$Price, 0.25)
mean(df_q2_cor$Price)
median(df_q2_cor$Price)
quantile(df_q2_cor$Price, 0.25)
#df_q2_cor$level <- ifelse(df_q2_cor$Price < 1978.28, "low", "high")
df_q2_cor <- df_q2_cor %>% mutate(level = case_when((df_q2_cor$Price <= 1978.28) ~ "Low",
((df_q2_cor$Price > 1978.28) & (df_q2_cor$Price < 6511.446)) ~ "Medium",
(df_q2_cor$Price > 6511.446) ~ "High"
))
df_q2_cor
table(df_q2_cor$level)
# load the library
library(caret)
# define training control
train_control <- trainControl(method="boot", number=100)
# train the model
model <- train(level~., data=df_q2_cor, trControl=train_control, method="nb")
# summarize results
print(model)
# define training control
train_control <- trainControl(method="repeatedcv", number=10, repeats=3)
# train the model
model_knn <- train(level~., data=df_q2_cor, trControl=train_control, method="knn")
#model_rpart <- train(level~., data=df_q2_cor, trControl=train_control, method="rpart")
model_pls <- train(level~., data=df_q2_cor, trControl=train_control, method="pls")
model_rda <- train(level~., data=df_q2_cor, trControl=train_control, method="rda")
# summarize results
print(model_knn)
par(mfrow=c(3,1))
boxplot(model_knn$results$Accuracy, ylab = "knn",xlab = "Accuracy", horizontal = TRUE)
#boxplot(model_rpart$results$Accuracy, ylab = "rpart",xlab = "Accuracy", horizontal = TRUE)
boxplot(model_pls$results$Accuracy, ylab = "pls",xlab = "Accuracy", horizontal = TRUE)
## redundancy analysis
boxplot(model_rda$results$Accuracy, ylab = "rda",xlab = "Accuracy", horizontal = TRUE)
model_rpart <- train(level~., data=df_q2_cor, trControl=train_control, method="rpart")
model_rpart
boxplot(model_rpart$results$Accuracy, ylab = "rpart",xlab = "Accuracy", horizontal = TRUE)
# Partial Least Squares
model_pls <- train(level~., data=df_q2_cor, trControl=train_control, method="pls")
model_pls
boxplot(model_pls$results$Accuracy, ylab = "pls",xlab = "Accuracy", horizontal = TRUE)
model_rda <- train(level~., data=df_q2_cor, trControl=train_control, method="rda")
model_rda
boxplot(model_rda$results$Accuracy, ylab = "pls",xlab = "Accuracy", horizontal = TRUE)
set.seed(1)
df_q2_cor$level <- as.factor(df_q2_cor$level)
split = 0.8
df_q2_cor
## 80% 20% train/test
trainIndex <- createDataPartition(df_q2_cor$level, p = split, list = FALSE)
data_train <- df_q2_cor[trainIndex, ]
data_test <- df_q2_cor[-trainIndex, ]
##naive bayes model
model = train(df_q2_cor$level ~ df_q2_cor$new_vaccinations+df_q2_cor$new_tests+df_q2_cor$new_cases+df_q2_cor$Price, data = data_train)
